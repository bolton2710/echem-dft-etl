# Demo of ETL workflow using Airflow for electrochemical oxide materials

## 1. Walkthrough (5 mins read)

### A. Intro
Electrodes are the building blocks for battery and electrocatalysis applications.
Among electrode materials, oxides are commonly encountered in water electrolysis for green H$_2$ production (e.g., Iridium/Nickel oxides).
Because oxide materials are vast and electrochemical experiments are time-consuming,
computational screening of oxide electrodes is among the cutting-edge ideas.
This demo illustrates a workflow that screens vanadium oxides for electrochemical properties.

### B. ETL workflow orchestration
This workflow---broadly classified as Extract-Transform-Load (ETL)---comprises of six steps:
1. Search for bulk vanadium oxides from the [Material Projects](https://next-gen.materialsproject.org/) using its [MP-API](https://next-gen.materialsproject.org/api).
2. Generate surfaces with different facets and termination  using [pymatgen](https://pymatgen.org/).
3. Run electrochemical grand-canonical DFT (GC-DFT) using [JDFTx](https://jdftx.org).
4. Analyze GC-DFT output for electrochemical potential of zero charge (PZC) and double-layer capacitance.
5. Load data to a [postgreSQL](https://www.postgresql.org/) database.
6. Print report.

[Apache-Airflow](https://airflow.apache.org/) is used for orchestrating the above ETL workflow.
A DAG was created with the [TaskFlow API](https://airflow.apache.org/docs/apache-airflow/stable/tutorial/taskflow.html).

![Screenshot from Airflow GUI](./dag.png)

For demo purposes:
- Only vanadium (IV) oxides are searched for.
- Only the (111) facet of 2 randomly picked bulk structures are generated.
- Minimal DFT (inaccurate but fast) settings are used on 1 randomly picked surface.
- A minimal toy postgres database using [psycopg](https://www.psycopg.org/docs/index.html) was implemented.
- The report is just a simple figure with annotations and atomic structure, shown in Markdown.

### C. Folder tour
The Airflow DAG is written in [/dags/my_dag.py](./dags/my_dag.py).

Bulk structures from Materials Project are saved as POSCARs in [/output/bulk_poscars/](./output/bulk_poscars/).

Surface/slab structures generated by pymatgen are saved in [/output/slab_poscars/](./output/slab_poscars/).

GC-DFT input and output files are in [/output/gc_dft/](./output/gc_dft/).

Generated output report is at [/output/report.md](./output/report.md)

### D. Output
GC-DFT computes the electrochemical potential of the generated oxide surface.
At no net charge, this gives the potential of zero charge (PZC).
The excess charges versus potentials should yield a linear line, of which the slope gives the electrochemical double-layer capacitance (see plot).

![Example of report](./output/visualize/mp-755394-111-3.png)

My work has shown the PZC and capacitance to be descriptors for the kinetics of adsorption and catalytic reaction.
\[[1](https://www.nature.com/articles/s42004-025-01579-y),
[2](https://pubs.rsc.org/en/content/articlehtml/2025/sc/d5sc03757c)\]

## 2. Reproduce (1-2 hours)

*Requirements: Docker*

https://airflow.apache.org/docs/apache-airflow/stable/howto/docker-compose/index.html

    echo -e "AIRFLOW_UID=$(id -u)" > .env